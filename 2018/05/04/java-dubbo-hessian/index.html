<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Hessian Lite序列化简析 | Peachey Blog</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Dubbo" />
    
    <meta name="description" content="dubbo是一个专注于服务治理的高性能rpc框架，支持服务之间的远程调用，Hessian序列化的存在是服务间沟通的桥梁，以下是本人阅读各种资料以及源码，对hessian序列化的一点整理与理解，如有错误请指出。  目录 Hessian Lite序列化简介 Hessian Lite源码解析2.1 Hessian Lite类结构2.2 Hessian Lite源码解析2.3 序列化器和反序列化器 H">
<meta name="keywords" content="Dubbo">
<meta property="og:type" content="article">
<meta property="og:title" content="Hessian Lite序列化简析">
<meta property="og:url" content="peachey.blog/2018/05/04/java-dubbo-hessian/index.html">
<meta property="og:site_name" content="Peachey Blog">
<meta property="og:description" content="dubbo是一个专注于服务治理的高性能rpc框架，支持服务之间的远程调用，Hessian序列化的存在是服务间沟通的桥梁，以下是本人阅读各种资料以及源码，对hessian序列化的一点整理与理解，如有错误请指出。  目录 Hessian Lite序列化简介 Hessian Lite源码解析2.1 Hessian Lite类结构2.2 Hessian Lite源码解析2.3 序列化器和反序列化器 H">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="/img/java/dubbo.png">
<meta property="og:updated_time" content="2018-09-17T04:27:33.200Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hessian Lite序列化简析">
<meta name="twitter:description" content="dubbo是一个专注于服务治理的高性能rpc框架，支持服务之间的远程调用，Hessian序列化的存在是服务间沟通的桥梁，以下是本人阅读各种资料以及源码，对hessian序列化的一点整理与理解，如有错误请指出。  目录 Hessian Lite序列化简介 Hessian Lite源码解析2.1 Hessian Lite类结构2.2 Hessian Lite源码解析2.3 序列化器和反序列化器 H">
<meta name="twitter:image" content="/img/java/dubbo.png">
    

    
        <link rel="alternate" href="/" title="Peachey Blog" type="application/atom+xml" />
    

    
        <link rel="icon" href="/css/images/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">Never Give Up</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/DB/">DB</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/DB/Mysql/">Mysql</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/">Java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Python/">Python</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/杂记/">杂记</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/算法/">算法</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Java/">Java</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-java-dubbo-hessian" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Hessian Lite序列化简析
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2018/05/04/java-dubbo-hessian/" class="article-date">
            <time datetime="2018-05-04T14:55:33.000Z" itemprop="datePublished">2018-05-04</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Dubbo/">Dubbo</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p><img src="/img/java/dubbo.png" alt=""></p>
<blockquote>
<p>dubbo是一个专注于服务治理的高性能rpc框架，支持服务之间的远程调用，Hessian序列化的存在是服务间沟通的桥梁，以下是本人阅读各种资料以及源码，对hessian序列化的一点整理与理解，如有错误请指出。</p>
</blockquote>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#1">Hessian Lite序列化简介</a></li>
<li><a href="#2">Hessian Lite源码解析</a><br>2.1 <a href="#2.1">Hessian Lite类结构</a><br>2.2 <a href="#2.2">Hessian Lite源码解析</a><br>2.3 <a href="#2.3">序列化器和反序列化器</a></li>
<li><a href="#3">Hessian Lite序列化详述</a><br>3.1 <a href="#3.1">序列化类型</a><br>3.2 <a href="#3.2">序列化详述</a></li>
<li><a href="#4">序列化协议对比</a></li>
<li><a href="#5">参考</a></li>
</ol>
<p><span id="1"></span></p>
<h3 id="1-Hessian2序列化"><a href="#1-Hessian2序列化" class="headerlink" title="1. Hessian2序列化"></a>1. Hessian2序列化</h3><p>hessian是一个动态类型,二进制序列化,也是网络协议,为了对象的定向传输,hessian协议有以下的设计目标：</p>
<ul>
<li>它必须支持描述序列化的类型，即不需要外部架构和接口定义;</li>
<li>它必须是跨语言的，要支持包括脚本语言;</li>
<li>它必须是可以通过单一方式进行读写;</li>
<li>它要尽可能的简洁;</li>
<li>它必须是简单的，它可以有效地测试和实施;</li>
<li>尽可能的快;</li>
<li>必须要支持Unicode编码;</li>
<li>它必须支持八位二进制数据;</li>
<li>它必须支持加密,压缩,签名,还有事务的上下文。</li>
</ul>
<p>Hessian是二进制传输协议，不需要其他的附加信息，因此是一种很好的能够支持跨语言特性，但是不同的语言需要一套Hessian的实现。</p>
<p><span id="2"></span></p>
<h3 id="2-Dubbo-Hessian-Lite源码解析"><a href="#2-Dubbo-Hessian-Lite源码解析" class="headerlink" title="2. Dubbo Hessian Lite源码解析"></a>2. Dubbo Hessian Lite源码解析</h3><p><span id="2.1"></span></p>
<h4 id="2-1-Hessian-Lite类结构"><a href="#2-1-Hessian-Lite类结构" class="headerlink" title="2.1 Hessian Lite类结构"></a>2.1 Hessian Lite类结构</h4><p><img src="/img/java/dubbo-hessian2-class.jpg" alt="Dubbo Hessian Lite类图"></p>
<p>以上类图是Dubbo Hessian序列化的类结构图，以下对核心类进行讲解：</p>
<ul>
<li><p><code>Serialization</code>:此接口定义了序列化方式的规格，Dubbo中每种序列化方式都需要实现此接口定义的方式，此接口持有四个方法：<code>getContentTypeId</code>是获取序列化类型id,此值在dubbo协议头里边也会用到; <code>getContentType</code>此方法是获取序列化类型，一种定义的字符串，比如Hessian是<code>x-application/hessian2</code>,在框架中也没有具体的调用地方; <code>serialize</code>此方法用于序列化; <code>deserialize</code>此方法用于反序列化。</p>
</li>
<li><p><code>Hessian2Serialization</code>: 这个类是外部调用序列化的入口，这个类实现了<code>Serialization</code>接口, <code>serialize</code>和<code>deserialize</code>是返回新建序列化处理对象，比如<code>return new Hessian2ObjectOutput(out);</code>，通过此种方式保证线程安全调用。</p>
</li>
<li><p><code>Hessian2Input</code>/<code>Hessian2Output</code>: 这两个类是序列化的核心调度类，所有类型的序列化都是通过该类的方法来实现的，此两个类会依赖<code>Hessian2SerializerFactory</code>此类去选择相应的<code>Serializer</code>和<code>Deserializer</code>,然后调用相应方法进行序列化或反序列化。</p>
</li>
<li><p><code>Hessian2SerializerFactory</code>: 这个是<code>Serializer</code>和<code>Deserializer</code>的工厂类，继承了<code>SerializerFactory</code>,大部分实现都在<code>SerializerFactory</code>类中，类内部持有静态<code>Map</code>，以类型为KEY, 存储<code>Serializer</code>或<code>Deserializer</code>（value），并且对外提供了两个方法<code>getSerializer</code>和<code>getDeserializer</code>分别用于获取相应的<code>Serializer</code>和<code>Deserializer</code>。</p>
</li>
<li><p><code>AbstractSerializer</code>/<code>AbstractDeserializer</code>: 这两个类分别实现了<code>Serializer</code>和<code>Deserializer</code>，是具体的序列化器和反序列化器的父抽象类，从此类衍生出了很多具体类型的序列化器和反序列化器，类图中未完全给出，包括一些java 8类型的序列化器和反序列化器。</p>
</li>
</ul>
<p><span id="2.2"></span></p>
<h4 id="2-2-Hessian-Lite序列化和反序列化流程"><a href="#2-2-Hessian-Lite序列化和反序列化流程" class="headerlink" title="2.2 Hessian Lite序列化和反序列化流程"></a>2.2 Hessian Lite序列化和反序列化流程</h4><p><img src="/img/java/hessian-serialize.jpg" alt="Hessian Lite序列化流程"></p>
<ul>
<li><p>Hessian Lite序列化流程如上时序图所述，之前的类图上没有加入<code>DubboCodec</code>，是因为这个不是本文所要分享的内容，与dubbo的rpc通信相关；时序图中描述序列化对象，对象只是一个抽象的称呼，可以是<code>Object</code>、<code>List</code>、<code>Map</code>等等,<code>DubboCodec</code>是对<code>ExchangeCodec</code>的一个继承，并重写了部分方法，其中对于协议头的序列化实现在<code>ExchangeCodec</code>中完成的，<code>DubboCodec</code>中会序列化一些附加信息；</p>
</li>
<li><p>通过<code>Hessian2Serialization</code>获取一个<code>Hessian2ObjectOutput</code>对象，并利用<code>Hessian2ObjectOutput</code>执行序列化操作，<code>Hessian2ObjectOutput</code>内部持有一个<code>Hessian2Objectput</code>变量，具体的序列化操作是实现在<code>Hessian2Objectput</code>, <code>Hessian2Objectput</code>是序列化的核心调度类，其内部会根据具体的类型通过<code>Hessian2SerializerFactory</code>选择相应的序列化器来完成Java对象到二进制数据的转化，二进制数据会保存在<code>Hessian2Objectput</code>内部的buffer中。</p>
</li>
</ul>
<p><img src="/img/java/hessian-deserialize.jpg" alt="Hessian Lite反序列化流程"></p>
<ul>
<li><p>Hessian Lite反序列化流程如上时序图所述，<code>DubboCodec</code>需要区分是请求还是响应，对于请求利用<code>DecodeableRpcInvocation</code>来做处理，对于响应利用<code>DecodeableRpcResult</code>来做处理，其实序列化也是区分响应还是请求的，对于序列化<code>DubboCodec</code>是通过两个不同的函数实现的；</p>
</li>
<li><p>在<code>DecodeableRpcInvocation</code>或<code>DecodeableRpcResult</code>中还是一样的，获取到<code>Hessian2ObjectInput</code>, 通过<code>Hessian2ObjectInput</code>内部持有的<code>Hessian2Input</code>完成序列化， <code>Hessian2Input</code>是Hessian2反序列化的一个核心调度类，其内部会根据具体的类型通过<code>Hessian2SerializerFactory</code>选择相应的反序列化器来进行反序列化的，<code>DubboCodec</code>最后会将<code>DecodeableRpcInvocation</code>或<code>DecodeableRpcResult</code>放入向上返回的<code>Request</code>或者<code>Response</code>中；</p>
</li>
<li><p>有必要提一下无论是序列化还是反序列化获取<code>ObjectOutput</code>或<code>ObejctInput</code>都是通过一个<code>CodecSupport</code>的工具类完成的，<code>CodecSupport</code>先确定<code>Serialization</code>（hessian或者其他），然后再通过<code>Serialization</code>来获取<code>ObjectOutput</code>或<code>ObejctInput</code>。</p>
</li>
</ul>
<p><span id="2.3"></span></p>
<h4 id="2-3-序列化器和反序列化器"><a href="#2-3-序列化器和反序列化器" class="headerlink" title="2.3 序列化器和反序列化器"></a>2.3 序列化器和反序列化器</h4><h5 id="2-3-1-选择序列化器或反序列化器"><a href="#2-3-1-选择序列化器或反序列化器" class="headerlink" title="2.3.1 选择序列化器或反序列化器"></a>2.3.1 选择序列化器或反序列化器</h5><p>当序列化或反序列化的时候会选择与该类型匹配的序列化器，此过程主要是在<code>SerializerFactory</code>该类中完成，此类继承抽象类<code>AbstractSerializerFactory</code>,对外有两个方法<code>getSerializer</code>和<code>getDeserializer</code>，此二方法的作用是通过<code>Class&lt;?&gt;</code>来获取相应的序列化器或反序列化器, 流程如下，此流程只是图形化一下Dubbo中的代码逻辑，并非一定要按照如此优先级进行。</p>
<p><img src="/img/java/find-serializer.jpg" alt="选择序列化器"></p>
<ul>
<li><p>静态Map在类初始化时，以<code>Class</code>为key,<code>Serializer</code>为value,进行了一系列的<code>put</code>操作,其中涉及类型<code>void</code>,<code>Boolean</code>,<code>Byte</code>,<code>Short</code>,<code>Integer</code>,<code>Long</code>,<code>Float</code>,<code>Double</code>,<code>Character</code>, <code>String</code>, <code>Object</code>, <code>java.util.Date</code>, <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>char</code>, <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>char</code>, <code>String</code>, <code>Object</code>, <code>Class</code>, <code>BigDecimal</code>, <code>File</code>, <code>ObjectName</code>, <code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code> , <code>java.io.InputStream</code>, <code>java.time.LocalTime</code>, <code>java.time.LocalDate</code>, <code>java.time.LocalDateTime</code>, <code>java.time.Instant</code>, <code>java.time.Duration</code>, <code>java.time.Period</code>, <code>java.time.Year</code>, <code>java.time.YearMonth</code>, <code>java.time.MonthDay</code>, <code>java.time.OffsetDateTime</code>, <code>java.time.ZoneOffset</code>, <code>java.time.OffsetTime</code>, <code>java.time.ZonedDateTime</code>,此步操作是通过具体类型来获取序列化器；</p>
</li>
<li><p>缓存Map是当从静态Map中获取不到时，会后续的操作，确定序列化器后会将之放入缓存Map当中，此操作可以看成是一种提高性能的做法。</p>
</li>
<li><p>其他工厂是加载其他的工厂类来获取相应的序列化器，不过debug到这个地方，装载工厂类的Map是空，具体作用待定。</p>
</li>
<li><p><code>writeReplace</code>与<code>readResolve</code>的作用一样，如果序列化的对象具有此方法，会利用此方法返回的实例来代替序列化后实例，用以保证对象的单例性。</p>
</li>
<li><p>后续的其他类型会判断传入的类型是否为与其类型一致，或者为其子类，来获取相应的序列化器。</p>
</li>
<li><p>默认的序列化器<code>JavaSerializer</code>是用以处理以上类型未包含的类型，比如自定义的对象类型，这个官方的Hessian有点区别，官方的Hessian的默认序列化器是<code>UnsafeSerializer</code>(具体的类不包含<code>writeReplace</code>方法),这个与<code>JavaSerializer</code>的区别是先将对象序列化成<code>Map</code>,同样反序列化时候<code>UnsafeDeserializer</code>先将二进制数据序列化成Map，然后再将Map转化成对象，而<code>JavaDeserializer</code>会新建一个对象然后再把属性设置进去。</p>
</li>
</ul>
<p><img src="/img/java/find-deserializer.jpg" alt="选择反序列化器"></p>
<ul>
<li>选择反序列化器之前的步骤和上述差不多，值得一提的反序列化<code>Class</code>类型时为何不将之放入静态Map当中，是因为改反序列化器需要获取当前的类加载器，而且在流程中还少了一些类型，是因为在初始化静态Map时，将其及其子类已经放入了静态Map当中。</li>
</ul>
<blockquote>
<p>详细实现请参见：com.alibaba.com.caucho.hessian.io.SerializerFactory</p>
</blockquote>
<h5 id="2-3-2-部分序列化器和反序列化器介绍"><a href="#2-3-2-部分序列化器和反序列化器介绍" class="headerlink" title="2.3.2 部分序列化器和反序列化器介绍"></a>2.3.2 部分序列化器和反序列化器介绍</h5><h6 id="BasicSerializer-BasicSerializer"><a href="#BasicSerializer-BasicSerializer" class="headerlink" title="BasicSerializer/BasicSerializer"></a>BasicSerializer/BasicSerializer</h6><p>该序列化器和反序列化器负责序列化的类型是：<code>null</code>, <code>Boolean/boolean</code>, <code>byte/Byte</code>, <code>short/Short</code>, <code>int/Integer</code>, <code>long/Long</code>, <code>float/Float</code>, <code>double/Double</code>, <code>char/Character</code>, <code>String</code>, 以上类型的数组，<code>Number</code>, <code>Object</code>, <code>Date</code>等，其中<code>byte/Byte</code>, <code>short/Short</code>, <code>int/Integer</code>都是按照整型来序列化与反序列化，<code>float/Float</code>, <code>double/Double</code>都是按照双精度浮点型来序列化与反序列化。</p>
<h6 id="ClassDeserializer-ClassSerializer"><a href="#ClassDeserializer-ClassSerializer" class="headerlink" title="ClassDeserializer/ClassSerializer"></a>ClassDeserializer/ClassSerializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>Class</code>, 对此执行序列化时，是将<code>java.lang.Class</code>以及对象的全类名以字符串的序列化，当反序列化时会根据类的全类名利用<code>Class.forName</code>来加载Class。</p>
<h6 id="StringValueSerializer-StringValueDeserializer"><a href="#StringValueSerializer-StringValueDeserializer" class="headerlink" title="StringValueSerializer/StringValueDeserializer"></a>StringValueSerializer/StringValueDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>BigDecimal</code>, <code>ObjectName</code>, 执行序列化时，会将<code>BigDecimal</code>格式化成字符串, 反序列化时再将字符串格式化成<code>BigDecimal</code>，这也是<code>BigDecimal</code>序列化精度不丢失的原因，不过相对而言序列化性能会稍微差点，<code>ObjectName</code>是JMX MBean要注册的对象名称，此处不做过多介绍。</p>
<h6 id="SqlDateSerializer-SqlDateDeserializer"><a href="#SqlDateSerializer-SqlDateDeserializer" class="headerlink" title="SqlDateSerializer/SqlDateDeserializer"></a>SqlDateSerializer/SqlDateDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>java.sql.Date</code>, 与<code>Date</code>序列化一样，会将通过long型时间戳作为中间变量进行序列化和反序列化。</p>
<h6 id="InputStreamSerializer-InputStreamDeserializer"><a href="#InputStreamSerializer-InputStreamDeserializer" class="headerlink" title="InputStreamSerializer/InputStreamDeserializer"></a>InputStreamSerializer/InputStreamDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>InputStream</code>, 具体的序列化过程是将<code>InputStream</code>中分块将写入<code>Hessian2Output</code>中的buffer当中，在反序列化时候再分块读取。</p>
<h6 id="MapSerializer-MapDeserializer"><a href="#MapSerializer-MapDeserializer" class="headerlink" title="MapSerializer/MapDeserializer"></a>MapSerializer/MapDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>Map</code>及其子类, 具体序列化时候会写入<code>Map</code>头，有类型的写入标识<code>M</code>, 无类型的写入标识<code>H</code>，然后再迭代序列化每个对象，最后再<code>Map</code>的尾标识<code>Z</code>。</p>
<h6 id="CollectionSerializer-CollectionDeserializer"><a href="#CollectionSerializer-CollectionDeserializer" class="headerlink" title="CollectionSerializer/CollectionDeserializer"></a>CollectionSerializer/CollectionDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>Collection</code>及其子类, 比如<code>List</code>、<code>Set</code>等等，具体序列化时候会写入<code>Collection</code>头标识，然后再迭代序列化每个对象，最后再<code>Collection</code>的尾标识，具体序列化细节会在下边详述。</p>
<h6 id="EnumSerializer-EnumDeserializer"><a href="#EnumSerializer-EnumDeserializer" class="headerlink" title="EnumSerializer/EnumDeserializer"></a>EnumSerializer/EnumDeserializer</h6><p>该序列化器和反序列化器负责序列化的类型是:<code>Enum</code>及其子类，具体序列化过程会将枚举类全类名以及枚举值以字符串形式序列化，在反序列化过程中会用反射的方式来构建枚举对象。</p>
<h6 id="ArraySerializer-ArrayDeserializer"><a href="#ArraySerializer-ArrayDeserializer" class="headerlink" title="ArraySerializer/ArrayDeserializer"></a>ArraySerializer/ArrayDeserializer</h6><p>该序列化器和反序列化器负责序列化数组类型，其序列化过程是<code>Collection</code>序列化的一种情况，是按照定长列表形式来序列化的。</p>
<h6 id="JavaSerializer-JavaDeserializer"><a href="#JavaSerializer-JavaDeserializer" class="headerlink" title="JavaSerializer/JavaDeserializer"></a>JavaSerializer/JavaDeserializer</h6><p>该序列化器和反序列化器是默认的，负责序列化的类型是:自定义的对象类型、异常类型等等，其内部持有相应的<code>FieldSerializer</code>数组用来序列化对象中的基本类型字段，每种<code>FieldSerializer</code>内部序列化以及其他对象类型还是调用<code>Hessian2Output</code>相应的序列化方法，反序列化也有类似的过程。</p>
<p><span id="3"></span></p>
<h3 id="3-Hessian-Lite序列化详述"><a href="#3-Hessian-Lite序列化详述" class="headerlink" title="3 Hessian Lite序列化详述"></a>3 Hessian Lite序列化详述</h3><p><span id="3.1"></span></p>
<h4 id="3-1-序列化类型"><a href="#3-1-序列化类型" class="headerlink" title="3.1 序列化类型"></a>3.1 序列化类型</h4><p>hessian对象序列化有8个基本类型：</p>
<ul>
<li>原始二进制数据</li>
<li>布尔</li>
<li>64位的毫秒日期类型</li>
<li>64位double类型</li>
<li>32位int类型</li>
<li>64位long类型</li>
<li>null</li>
<li>UTF-8编码的字符串</li>
</ul>
<p>有3中可遍历的类型：</p>
<ul>
<li>列表(List)：lists and arrays</li>
<li>映射(Map)：maps and dictionaries</li>
<li>对象(Object): objects</li>
</ul>
<p>同时还有3个内置的引用映射：</p>
<ul>
<li>对象/列表引用映射</li>
<li>类定义引用映射</li>
<li>类型引用映射（类名）</li>
</ul>
<p><span id="3.2"></span></p>
<h4 id="3-2-序列化详述"><a href="#3-2-序列化详述" class="headerlink" title="3.2 序列化详述"></a>3.2 序列化详述</h4><blockquote>
<p>语法是hessian标准的语法</p>
</blockquote>
<h5 id="二进制数据（byte-array）"><a href="#二进制数据（byte-array）" class="headerlink" title="二进制数据（byte array）"></a>二进制数据（byte array）</h5><h6 id="Hessian2语法"><a href="#Hessian2语法" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">binary ::= b b1 b0 &lt;binary-data&gt; binary</span><br><span class="line">       ::= B b1 b0 &lt;binary-data&gt;</span><br><span class="line">       ::= [x20-x2f] &lt;binary-data&gt;</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite"><a href="#Hessian-Lite" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>二进制数据是以块进行编码的，<code>B</code>表示最后一块，<code>b</code>表示非最后一块，b1表示长度的高八位，b0表示长度的第八位, 长度为一个字节是用l表示：</p>
<ul>
<li>非最后一块：利用<code>A</code>标识，<strong>这是dubbo与标准不同的地方</strong>，并用两个字节表示长度, 占用3个字节.</li>
<li>最后一块: 利用<code>B</code>标识，并用两个字节表示长度，占用3个字节.</li>
<li>[0, 0x0f]: 当前非最后一块切分剩下的部分的长度在此范围内，长度形式为<code>0x20+b0</code>，占用一个字节</li>
<li>[0x10, 0x3ff]: 当前非最后一块切分剩下的部分的长度在此范围内，长度形式为<code>0x34+b1 b0</code>，占用两个字节</li>
</ul>
<blockquote>
<p>序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeBytes(byte[], int, int)</p>
</blockquote>
<h5 id="布尔"><a href="#布尔" class="headerlink" title="布尔"></a>布尔</h5><h6 id="Hessian2语法-1"><a href="#Hessian2语法-1" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean ::= T</span><br><span class="line">        ::= F</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-1"><a href="#Hessian-Lite-1" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p><code>F</code>表示<code>false</code>, <code>T</code>表示<code>true</code>，直接利用字节序列化.</p>
<blockquote>
<p>序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeBoolean</p>
</blockquote>
<h5 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h5><h6 id="Hessian2语法-2"><a href="#Hessian2语法-2" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date ::= x4a b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">     ::= x4b b4 b3 b2 b1 b0</span><br></pre></td></tr></table></figure>
<p>用距离<code>1970-01-01 00:00:00</code>的一个64位长的毫秒值来表示日期</p>
<h6 id="Hessian-Lite-2"><a href="#Hessian-Lite-2" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>日期的序列化方式有两种，如果能够精确到分，可以用32位整型来表示，否则只能用64位整型来表示，<code>0x4b</code>表示32位形式，<code>0x4a</code>表示64位形式, 然后将值移位序列化为二进制.</p>
<blockquote>
<p>序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeUTCDate</p>
</blockquote>
<h5 id="Double"><a href="#Double" class="headerlink" title="Double"></a>Double</h5><h6 id="Hessian2语法-3"><a href="#Hessian2语法-3" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">double ::= D b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">       ::= x5b</span><br><span class="line">       ::= x5c</span><br><span class="line">       ::= x5d b0</span><br><span class="line">       ::= x5e b1 b0</span><br><span class="line">       ::= x5f b3 b2 b1 b0</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-3"><a href="#Hessian-Lite-3" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>在序列化Double时，是分了几种类型，每种序列化的方式都是要将Double转成整型，然后利用移位填充每个字节：</p>
<ul>
<li>0x5b代表<code>Double.Zero</code></li>
<li>0x5c代表<code>Double.One</code></li>
<li>0x5d代表大小精确到一个字节表示的Double类型</li>
<li>0x5e代表大小精确到两个个字节表示的Double类型</li>
<li>0x5f代表只有3位小数以内的Double类型</li>
<li>默认是8个字节表示，<code>D</code>位Double的标识</li>
</ul>
<blockquote>
<p>为什么要分这么多种方式，是一种提高性能的方式，如果数值很小的话，用8个字节表示，首先会增大传输数据长度，其次8个字节是遵循ieee754标准的，运算过程会相对复杂一点, 并且dubbo中float类型利用序列双精度浮点数类型来处理，序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeDouble</p>
</blockquote>
<h6 id="IEEE754-双精度浮点数"><a href="#IEEE754-双精度浮点数" class="headerlink" title="IEEE754 双精度浮点数"></a><a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener">IEEE754 双精度浮点数</a></h6><p><code>Double.doubleToLongBits</code>这个函数底层调用的是<code>java.lang.Double#doubleToRawLongBits</code>,这是一个native方法,看不到具体的实现方式，但是是ieee745标准的一个实现，以下对ieee754标准的双精度浮点数做一个原理做一个概述性的介绍。<br>双精度浮点数的IEEE754格式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">| 符号 <span class="number">1</span>bit |     幂 <span class="number">11</span>bit       |              分数  <span class="number">52</span> bit                 |</span><br><span class="line">-----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<ul>
<li>符号1位：0表示此值为正，1表示此值为负数</li>
<li>幂11位：指数域的编码值为指数的实际值加上某个固定的值，该固定值为 2^(e-1)-1</li>
<li>分数52位：也就是指转化为科学计数法后的小数部分</li>
</ul>
<p>举个例子，18.9转换成此种形式：</p>
<ul>
<li>18.9为正数，所以符号位为0</li>
<li>log2(18.9)=4.24,则指数为可以看做是二进制的4次方，也就是1023+4=1027为10000000011</li>
<li>18.9/2^4=1.18125,注意默认将1去掉，则将0.18125转化为小数二进制为0010111001100110011001100110011001100110011001100110(怎么小数转换成二进制情百度)</li>
<li>然后拼起来便是一个完整的64位双精度的表示方式</li>
</ul>
<blockquote>
<p>还有一些特殊形式，比如<code>+0</code>,<code>-0</code>,<code>NaN</code>等，此处不做多讲述，想了解的可以戳小标题（维基百科，需要翻墙）</p>
</blockquote>
<h5 id="整型（int）"><a href="#整型（int）" class="headerlink" title="整型（int）"></a>整型（int）</h5><h6 id="Hessian2语法-4"><a href="#Hessian2语法-4" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int ::= &apos;I&apos; b3 b2 b1 b0</span><br><span class="line">    ::= [x80-xbf]</span><br><span class="line">    ::= [xc0-xcf] b0</span><br><span class="line">    ::= [xd0-xd7] b1 b0</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-4"><a href="#Hessian-Lite-4" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>为了提高序列化效率，整型分类几种类型去处理, 用<code>v</code>来表示要序列化的值, 形式并按字节顺序排列, b3, b2, b1, b0分别表示长度的各个8位：</p>
<ul>
<li>[-0x10, 0x2f]: 如果值大小位于此区间，占用1个字节，形式为<code>b0+0x90</code>.</li>
<li>[-0x800, 0x7ff]: 如果值大小位于此区间，占用2个字节，形式为<code>b1+0xc8 b0</code>.</li>
<li>[-0x40000, 0x3ffff]: 如果值大小位于此区间，占用3个字节, 形式为<code>b2+0xd4 b1 b0</code>.</li>
<li>除上述以上情况外，序列化需要占用9个字节，形式<code>I b3 b2 b1 b0</code>, <code>I</code>是整型的标识.</li>
</ul>
<blockquote>
<p>dubbo中byte,short类型利用序列化整型处理，序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeInt</p>
</blockquote>
<h5 id="长整型（long）"><a href="#长整型（long）" class="headerlink" title="长整型（long）"></a>长整型（long）</h5><h6 id="Hessian2语法-5"><a href="#Hessian2语法-5" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">long ::= L b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">     ::= [xd8-xef]</span><br><span class="line">     ::= [xf0-xff] b0</span><br><span class="line">     ::= [x38-x3f] b1 b0</span><br><span class="line">     ::= x4c b3 b2 b1 b0</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-5"><a href="#Hessian-Lite-5" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>长整型在序列化时候与双精度浮点型类似，为了提高序列化效率，也是分类几种类型去处理, b7, b6, b5, b4, b3, b2, b1, b0分别表示长度的各个8位：</p>
<ul>
<li>[-0x08, 0x0f]: 如果值大小位于此区间，占用1个字节，形式为<code>b0+0xe0</code>.</li>
<li>[-0x800, 0x7ff]: 如果值大小位于此区间，占用2个字节，形式为<code>b1+0xf8 b0</code>.</li>
<li>[-0x40000, 0x3ffff]: 如果值大小位于此区间，占用3个字节, 形式为<code>b2+0x3c b1 b0</code>.</li>
<li>[-0x80000000, 0x7fffffff]: 如果值大小位于此区间，占用5个字节，形式<code>0x59 b3 b2 b1 b0</code> , <strong>此处的前缀<code>0x59</code>是dubbo与标准hessian的一个区别</strong></li>
<li>除上述以上情况外，序列化需要占用9个字节，形式<code>L b7 b6 b5 b4 b3 b2 b1 b0</code>, <code>L</code>是长整型的标识.</li>
</ul>
<blockquote>
<p>序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeLong</p>
</blockquote>
<h5 id="null"><a href="#null" class="headerlink" title="null"></a>null</h5><h6 id="Hessian2语法-6"><a href="#Hessian2语法-6" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">null ::= N</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-6"><a href="#Hessian-Lite-6" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p><code>null</code>的语法与<code>boolean</code>都很简单利用字符<code>N</code>占用一个字节来表示.</p>
<blockquote>
<p>序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeNull</p>
</blockquote>
<h5 id="UTF-8编码的字符串"><a href="#UTF-8编码的字符串" class="headerlink" title="UTF-8编码的字符串"></a>UTF-8编码的字符串</h5><h6 id="Hessian2语法-7"><a href="#Hessian2语法-7" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string ::= x52 b1 b0 &lt;utf8-data&gt; string</span><br><span class="line">       ::= S b1 b0 &lt;utf8-data&gt;</span><br><span class="line">       ::= [x00-x1f] &lt;utf8-data&gt;</span><br><span class="line">       ::= [x30-x33] b0 &lt;utf8-data&gt;</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-7"><a href="#Hessian-Lite-7" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>字符串会按照块来序列化，如果是最后一块用<code>S</code>来标识，如果不是最后一块利用<code>R</code>来标识, b1, b0分表表示长度高低8位：</p>
<ul>
<li>非最后一块：利用<code>R</code>标识，并用两个字节来表示长度</li>
<li>[0x00-0x1f]: 如果划分完所有的非最后一块，剩下的部分长度在此范围值内，则不用<code>S</code>来标识，而是直接序列化长度值.</li>
<li>[0x20-0x3ff]: 如果划分完所有的非最后一块，剩下的部分长度在此范围值内，则不用<code>S</code>来标识， 序列化形式为<code>0x30+b1 b0</code>,所以长度第一个字节范围[x30-x33]</li>
<li>否则序列化利用<code>S</code>来标识最后一块，并用两个字节来标识长度</li>
</ul>
<blockquote>
<p>dubbo中char类型利用序列化字符串方式来处理，序列化实现详细代码请阅读com.alibaba.com.caucho.hessian.io.Hessian2Output#writeString(java.lang.String)</p>
</blockquote>
<h5 id="列表-List"><a href="#列表-List" class="headerlink" title="列表(List)"></a>列表(List)</h5><h6 id="Hessian2语法-8"><a href="#Hessian2语法-8" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list ::= x55 type value* &apos;Z&apos;   # variable-length list</span><br><span class="line">     ::= &apos;V&apos; type int value*   # fixed-length list</span><br><span class="line">     ::= x57 value* &apos;Z&apos;        # variable-length untyped list</span><br><span class="line">     ::= x58 int value*        # fixed-length untyped list</span><br><span class="line">     ::= [x70-77] type value*  # fixed-length typed list</span><br><span class="line">     ::= [x78-7f] value*       # fixed-length   list</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-8"><a href="#Hessian-Lite-8" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>列表序列化，其实<code>Collection</code>和数组都会按照此形式进行序列化，会写入一个头和一个尾，中间的的对象按照对象来序列化，序列化过程如下：</p>
<ul>
<li>写入开始标识, 开始标识会分为几种形式，列表长度用len表示<ul>
<li>如果列表的长度为-1，类型确定为0x58, 并写入当前类型; 类型不确定为0x57, 此种形式在<code>Enumeration</code>和<code>Iterator</code>序列化中用到，不过目前我还不清楚这两种迭代器的序列化有何用；</li>
<li>如果列表的长度小于7，类型确定为0x70+len，类型不确定为0x78+len, 此种处理即将标识和长度放在一起，可以减小序列化后的size；</li>
<li>否则类型确定为<code>V</code>,并写入当前类型以及长度; 类型不确定为0x58，并写入长度。</li>
</ul>
</li>
<li>循环序列化对象</li>
<li>写入结束标识<code>Z</code></li>
<li><p>定长列表序列化过程：序列化写入标识<code>V</code>，序列化写入类的全类名，序列化写入长度，循环序列化写入各个对象，最后写入<code>Z</code></p>
</li>
<li><p>无类型定长列表序列化过程：先写入标识0x58，序列化写入长度，循环序列化写入各个对象，最后写入<code>Z</code></p>
</li>
</ul>
<blockquote>
<p>详细代码请阅读com.alibaba.com.caucho.hessian.io.CollectionSerializer</p>
</blockquote>
<h5 id="映射-Map"><a href="#映射-Map" class="headerlink" title="映射(Map)"></a>映射(Map)</h5><h6 id="Hessian2语法-9"><a href="#Hessian2语法-9" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map  ::= M type (value value)* Z</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-9"><a href="#Hessian-Lite-9" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p><code>Map</code>的序列化要相对简单一些，序列化过程如下：</p>
<ul>
<li>写入开始标识，分为两种类型<ul>
<li>确定类型为<code>M</code>,不确定类型为<code>H</code></li>
</ul>
</li>
<li>循环写入key和value</li>
<li>写入结束标识<code>Z</code></li>
</ul>
<blockquote>
<p>详细代码请阅读 com.alibaba.com.caucho.hessian.io.MapSerializer#writeObject</p>
</blockquote>
<h5 id="对象-Object"><a href="#对象-Object" class="headerlink" title="对象(Object)"></a>对象(Object)</h5><h6 id="Hessian2语法-10"><a href="#Hessian2语法-10" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class-def  ::= &apos;C&apos; string int string*</span><br><span class="line"></span><br><span class="line">object     ::= &apos;O&apos; int value*</span><br><span class="line">           ::= [x60-x6f] value*</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-10"><a href="#Hessian-Lite-10" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>序列化对象过程如下：</p>
<ul>
<li>写入开始标识，分以下几种类型<ul>
<li>如果之前已经写入该对象了，此时不会再次序列化类名称，会以类名引用方式写入，目的还是减小序列化size, 如果存放引用的列表size小于等于15，则标识为0x60+列表size; 否则标识为<code>O</code>,并接着写入列表size;</li>
<li>如果之前没有写入该对象，则标识为’C’,并接着写入全类名;</li>
</ul>
</li>
<li>分别序列化各个字段，虽然基本类型JavaSerializer中会持有<code>FieldSerilizer</code>,但序列化各个字段具体还是会调用<code>Hessian2Output</code>中的各个方法。</li>
</ul>
<blockquote>
<p>详细代码请阅读 com.alibaba.com.caucho.hessian.io.JavaSerializer#writeObject</p>
</blockquote>
<h5 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h5><h6 id="Hessian2语法-11"><a href="#Hessian2语法-11" class="headerlink" title="Hessian2语法"></a>Hessian2语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref ::= x51 int</span><br></pre></td></tr></table></figure>
<h6 id="Hessian-Lite-11"><a href="#Hessian-Lite-11" class="headerlink" title="Hessian Lite"></a>Hessian Lite</h6><p>对于引用类型有三种，分别为<code>Object/Collection/Map</code>的值引用，类定义的引用（类定义是指全类名以及类字段的名称），全类名的引用，主要目的是复用，用以提高序列化的效率；引用主要是在调用方完成，先把之前读取的缓存起来，提供方会按照顺序写入引用标识以及顺序值，调用方在遇到引用标识后会根据顺序值从相应列表中读取来完成。</p>
<p><span id="4"></span></p>
<h3 id="4-序列化协议对比"><a href="#4-序列化协议对比" class="headerlink" title="4. 序列化协议对比"></a>4. 序列化协议对比</h3><blockquote>
<p>此部分是参考论文Smart Grid Serialization Comparison，其中一些图也是源于此paper。</p>
</blockquote>
<p>本部分将要对比的涉及26中序列化协议，以下对此26中序列化协议进行简单介绍,对比的标准如下：</p>
<ul>
<li>序列化时间</li>
<li>反序列化时间</li>
<li>压缩时间</li>
<li>解压缩时间</li>
<li>序列化使用内存</li>
<li>压缩使用内存</li>
<li>序列化后的Size</li>
<li>压缩后的Size</li>
</ul>
<p>为了保证对比的合理性，对时间的取值为1000次的平均值，对于内存的取值为1000次垃圾回收器消耗的内存平均值，对于Size是对<a href="https://en.wikipedia.org/wiki/IEC_61850" target="_blank" rel="noopener">IEC-61850</a>数据模型类进行操作，用于合理准确的评估，测试机器配置：Win10，Jdk-1.8 64位，CPU i7-4600U，8GB内存，具体对比如下图：</p>
<p><img src="/img/java/serialize-process-time.jpg" alt="运行时间对比"></p>
<p><img src="/img/java/serialize-memory-consumption.jpg" alt="内存消耗对比"></p>
<p><img src="/img/java/serialize-message-size.jpg" alt="消息Size对比"></p>
<p>根据对比结果可知，protobuf性能已经达到令人发指的碾压程度，如果dubbo能够支持protobuf的话，序列化性能能够提升两倍。</p>
<p><span id="5"></span></p>
<h3 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h3><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-dev-book/" target="_blank" rel="noopener">dubbo官方文档</a></li>
<li><a href="http://hessian.caucho.com/doc/hessian-serialization.html" target="_blank" rel="noopener">hessian序列化协议</a></li>
<li><a href="http://orbit.dtu.dk/ws/files/127962965/Smart_Grid_Serialization_Comparision.pdf" target="_blank" rel="noopener">论文-Smart Grid Serialization Comparison</a></li>
<li>dubbo源码</li>
</ul>

        </div>
        <footer class="article-footer">
            


    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>


        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="valine-thread"></div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/05/04/study-plan/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            技术之路
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2018/03/21/db-innodb-index/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">Innodb索引原理</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/10/java-concurrenthashmap/" class="thumbnail">
    
    
        <span style="background-image:url(/img/java/java-concurrent.jpg)" alt="ConcurrentHashMap源码演进" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/12/10/java-concurrenthashmap/" class="title">ConcurrentHashMap源码演进</a></p>
                            <p class="item-date"><time datetime="2018-12-09T16:28:17.000Z" itemprop="datePublished">2018-12-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/11/16/java-art-code-segment/" class="thumbnail">
    
    
        <span style="background-image:url(/img/java/clean-code.png)" alt="精巧的代码片段设计" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/11/16/java-art-code-segment/" class="title">精巧的代码片段设计</a></p>
                            <p class="item-date"><time datetime="2018-11-16T08:49:14.000Z" itemprop="datePublished">2018-11-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/11/14/java-nio-overview/" class="thumbnail">
    
    
        <span style="background-image:url(/img/java/java-io.png)" alt="NIO原理详解" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/11/14/java-nio-overview/" class="title">NIO原理详解</a></p>
                            <p class="item-date"><time datetime="2018-11-13T16:37:57.000Z" itemprop="datePublished">2018-11-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/10/netty-overview/" class="thumbnail">
    
    
        <span style="background-image:url(/img/java/netty.jpeg)" alt="Netty面观" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/09/10/netty-overview/" class="title">Netty面观</a></p>
                            <p class="item-date"><time datetime="2018-09-09T18:44:06.000Z" itemprop="datePublished">2018-09-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/27/java-dubbo-exchange/" class="thumbnail">
    
    
        <span style="background-image:url(/img/java/dubbo.png)" alt="dubbo通信源码解析" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/08/27/java-dubbo-exchange/" class="title">dubbo通信源码解析</a></p>
                            <p class="item-date"><time datetime="2018-08-27T12:03:44.000Z" itemprop="datePublished">2018-08-27</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DB/">DB</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DB/Mysql/">Mysql</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Clean-Code/">Clean Code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dubbo/">Dubbo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/">LeetCode</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/">Mybatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Netty/">Netty</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nio/">Nio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shadowsocks/">Shadowsocks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Clean-Code/" style="font-size: 10px;">Clean Code</a> <a href="/tags/Dubbo/" style="font-size: 15px;">Dubbo</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/LeetCode/" style="font-size: 20px;">LeetCode</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/Mybatis/" style="font-size: 10px;">Mybatis</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Netty/" style="font-size: 10px;">Netty</a> <a href="/tags/Nio/" style="font-size: 10px;">Nio</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/并发/" style="font-size: 20px;">并发</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Peachey</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7-rc3/dist/Valine.min.js"></script>
    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:false,
            verify:true,
            app_id: 'm643zV6fkatNCTYrsSGVp9t7-gzGzoHsz',
            app_key: 'D2IHXCDEAUsrUI29D0U4CvYD',
            placeholder: '可以发表下你的看法~'
        });
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
